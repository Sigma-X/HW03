<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>d3-start</title>
    <script src="https://d3js.org/d3.v3.js"></script>
    
</head>
<body>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 <input type="button" value="新增" onclick="update()">&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" value="移除" onclick="update_remove()">
  
  <script>
    var w=1000;
    var h=300; //svg的寬高
    var p=100; //圖和邊框之距
    var arr = [85, 60, 99, 49, 77, 82];
        svg();
        bind(arr); 
        render();
      
        function svg(){ 
           d3.select("body")
             .append("svg")
             .attr({
               "width": w,
               "height": h-60
           });
        }
        function bind(data){
          var selection = d3.select("body")
                            .selectAll("rect")
                            .data(data); 
              selection.enter().append("rect");
              selection.exit().remove(); 
        }
          var selection_text = d3.select("svg")
                                .selectAll("text")
                                .data(data);
            selection_text.enter().append("text");
            selection_text.exit().remove();    
        
    
         function render(){ 
           d3.selectAll("rect")
             .attr({
               "x": function(d,i){
                   return p + 23 * i;
               },
               "y":function(d){
                   return h - p - d;
               },
               "width": 20,
               "height": function(d){
                 return d;
               },
               "fill": function(d){
               if(d < 70){
                 return "red"
               }
               else {
                 return "lightgreen"
               }
             }         
        });
       d3.selectAll("text")
         .attr({
               "x": function(d,i){
                 return p+23*i;
               }, 
               "y": function(d){
                 return h-p-d+d+20;
               },
               "font-size": 12
            })
            .text(function(d){
         return d;
       })
               
    }
        function update(){
          var num=random(10,100);
          arr.push(num); 
          bind(arr);
          render();
        }
    
        function update_remove(){
          var num=random(10,100);
          arr.pop(num); 
          bind(arr);
          render();
        }
 
        function random(N,M){
            return Math.ceil(Math.random()*(M-N)+N);
        }
    </script>
    <svg width="600" height="400">
    <rect x="100" y="115" width="20" height="85" fill="lightgreen"></rect>
    <rect x="123" y="140" width="20" height="60" fill="red">    
    </rect>
    <rect x="146" y="101" width="20" height="99" fill="lightgreen"></rect>
    <rect x="169" y="151" width="20" height="49" fill="red">        
    </rect>
    <rect x="192" y="123" width="20" height="77" fill="lightgreen"></rect>
    <rect x="215" y="118" width="20" height="82" fill="lightgreen"></rect>
    <text x="100" y="220" font-size="12">85</text>
    <text x="123" y="220" font-size="12">60</text>
    <text x="146" y="220" font-size="12">99</text>
    <text x="169" y="220" font-size="12">49</text>
    <text x="192" y="220" font-size="12">77</text>
    <text x="215" y="220" font-size="12">82</text>
    </svg>
    
  </body>
  </html>